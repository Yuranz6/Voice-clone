<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EHR Agent - 电子病历辅助系统</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <div>
                    <h1 data-i18n="title">🏥 EHR Agent - 电子病历辅助系统</h1>
                    <p class="subtitle" data-i18n="subtitle">智能问诊记录与病历生成系统</p>
                </div>
                <div class="language-switcher">
                    <button id="lang-zh" class="lang-btn active" onclick="i18n.setLanguage('zh')">中文</button>
                    <button id="lang-en" class="lang-btn" onclick="i18n.setLanguage('en')">English</button>
                </div>
            </div>
        </header>

        <!-- 患者信息表单 -->
        <section class="card" id="patient-info-section">
            <h2 data-i18n="patientInfo">📋 患者基本信息</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label data-i18n="patientName">患者姓名</label>
                    <input type="text" id="patient-name" data-i18n="patientNamePlaceholder" placeholder="请输入患者姓名">
                </div>
                <div class="form-group">
                    <label data-i18n="age">年龄</label>
                    <input type="text" id="patient-age" data-i18n="agePlaceholder" placeholder="请输入年龄">
                </div>
                <div class="form-group">
                    <label data-i18n="gender">性别</label>
                    <select id="patient-gender">
                        <option value="未提供" data-i18n="genderSelect">请选择</option>
                        <option value="男" data-i18n="genderMale">男</option>
                        <option value="女" data-i18n="genderFemale">女</option>
                        <option value="其他" data-i18n="genderOther">其他</option>
                    </select>
                </div>
                <div class="form-group">
                    <label data-i18n="medicalHistory">既往史</label>
                    <input type="text" id="patient-history" data-i18n="medicalHistoryPlaceholder" placeholder="请输入既往史，无则填'无'">
                </div>
                <div class="form-group">
                    <label data-i18n="allergies">过敏史</label>
                    <input type="text" id="patient-allergies" data-i18n="allergiesPlaceholder" placeholder="请输入过敏史，无则填'无'">
                </div>
                <div class="form-group">
                    <label data-i18n="currentMedications">当前用药</label>
                    <input type="text" id="patient-medications" data-i18n="currentMedicationsPlaceholder" placeholder="请输入当前用药，用逗号分隔，无则填'无'">
                </div>
            </div>
        </section>

        <!-- 问诊记录 -->
        <section class="card" id="consultation-section">
            <h2 data-i18n="consultation">🎤 问诊记录</h2>
            <div class="recording-controls">
                <button id="start-recording" class="btn btn-primary">
                    <span class="icon">🎤</span> <span data-i18n="startRecording">开始录音</span>
                </button>
                <button id="stop-recording" class="btn btn-danger" disabled>
                    <span class="icon">⏹</span> <span data-i18n="stopRecording">停止录音</span>
                </button>
                <button id="clear-text" class="btn btn-secondary">
                    <span class="icon">🗑</span> <span data-i18n="clearText">清空</span>
                </button>
            </div>
            <div id="recording-status" class="status-message"></div>
            <textarea id="consultation-text" rows="8" data-i18n="consultationPlaceholder" placeholder="点击'开始录音'进行语音输入，或直接在此输入问诊记录..."></textarea>
            <div class="char-count"><span data-i18n="charCount">字数</span>: <span id="char-count">0</span></div>
        </section>

        <!-- 操作按钮 -->
        <section class="card">
            <div class="action-buttons">
                <button id="generate-soap" class="btn btn-success" disabled>
                    <span class="icon">📝</span> <span data-i18n="generateSOAP">生成 SOAP 病历</span>
                </button>
                <button id="recommend-exams" class="btn btn-info" disabled>
                    <span class="icon">🔬</span> <span data-i18n="recommendExams">推荐检查项目</span>
                </button>
                <button id="check-drugs" class="btn btn-warning" disabled>
                    <span class="icon">💊</span> <span data-i18n="checkDrugs">检查药物冲突</span>
                </button>
                <button id="save-report" class="btn btn-primary" disabled>
                    <span class="icon">💾</span> <span data-i18n="saveReport">保存报告</span>
                </button>
            </div>
        </section>

        <!-- 加载提示 -->
        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p data-i18n="processing">处理中，请稍候...</p>
        </div>

        <!-- 结果显示区域 -->
        <section class="card hidden" id="soap-section">
            <h2 data-i18n="soapNote">📋 SOAP 病历</h2>
            <div id="soap-content" class="result-content"></div>
        </section>

        <section class="card hidden" id="examinations-section">
            <h2 data-i18n="examRecommendations">🔬 推荐检查项目</h2>
            <div id="examinations-content" class="result-content"></div>
        </section>

        <section class="card hidden" id="drug-check-section">
            <h2 data-i18n="drugCheck">💊 药物冲突检查</h2>
            <div id="drug-check-content" class="result-content"></div>
        </section>
    </div>

    <script>
        // 配置 API 基础 URL
        // 前端和后端在同一域名 (https://agent-rea2.onrender.com)，使用相对路径
        // 如果前端部署在其他地方，取消注释下面一行并设置完整的后端 URL
        // window.API_BASE_URL = 'https://agent-rea2.onrender.com';
        window.API_BASE_URL = window.API_BASE_URL || '';
    </script>
    <script src="{{ url_for('static', filename='js/i18n.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>

